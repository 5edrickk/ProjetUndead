#include <SFML/Graphics.hpp>
#include <SFML/Audio.hpp>
#include <string>
#include <iostream>

#include "constantes.h"
#include "functions.h"
#include "player.h"
#include "Background.h"

using namespace sf;
using namespace std;

int main() {

	//========================================================================================================================
	// Variables

	//========================================================================================================================
	// Objets de classes
	Clock clockUpdate;
	Time timeUpdate;

	Clock clockDraw;
	Time timeDraw;

	Player player;

	//========================================================================================================================
	// Render window
	sf::RenderWindow window(sf::VideoMode(WINDOW_SIZE_X, WINDOW_SIZE_Y), GAME_NAME, sf::Style::Close);
	window.setFramerateLimit(FRAMERATE);

	//========================================================================================================================
	// Background
	Background background[5]; // On crée un tableau de Backgrounds
	for (int i = 0; i < 5; i++)
	{
		background[i].setBackground(background[i].getBackground()); // On initialise le background
		Texture textureBackground; // On crée une texture pour le background
		textureBackground.loadFromFile("assets/backgrounds/background" + std::to_string(i) + ".png"); // On charge la texture
		background[i].setTexture(textureBackground, 0, 0, WINDOW_SIZE_X, WINDOW_SIZE_Y); // On applique la texture au background

	}
	int bkg = 0;
	int lastbkg=5;
	//========================================================================================================================
	// Joueur
	sf::RectangleShape sPlayer;

	sPlayer.setPosition(WINDOW_SIZE_X / 2, WINDOW_SIZE_Y / 2);
	sPlayer.setSize(sf::Vector2f(PLAYER_SIZE, PLAYER_SIZE));
	sPlayer.setFillColor(sf::Color::Black);

	sPlayer.setOrigin(PLAYER_SIZE / 2, PLAYER_SIZE / 2); // Point central du joueur pour la rotation
	
	//========================================================================================================================
	// Joueur hitbox
	FloatRect sPlayerBounds = sPlayer.getGlobalBounds();

	//========================================================================================================================
	// Boucle fenêtre : jusqu'à ce que la fenêtre soit fermée
	while (window.isOpen())
	{
		// On inspecte tous les évènements de la fenêtre qui ont été émis depuis la précédente itération
		Event event;
		int dir = 0;

		while (window.pollEvent(event))
		{
			// Évènement "fermeture demandée" : on ferme la fenêtre
			if (event.type == Event::Closed)
			{
				window.close();
			}
			// Détection des touches
			else if (event.type == Event::KeyPressed)
			{
				switch (event.key.code) {
				case Keyboard::Escape:
					window.close();
					break;
				case Keyboard::W:
					dir = 1;
					break;
				case Keyboard::D:
					dir = 2;
					break;
				case Keyboard::S:
					dir = 3;
					break;
				case Keyboard::A:
					dir = 4;
					break;
				default:
					break;
				}

			}
		}

		//========================================================================================================================

		// Boucle fenêtre > Boucle update
	
	


			//Defilement du joueur
			
			switch (dir)
			{
			case 1: // Haut
				bkg = 1; 
				lastbkg = bkg;
				
				break;
			case 2: // Droite
				bkg = 2;
				lastbkg = bkg;
				break;
			case 3: // Bas
				bkg = 3;
				lastbkg = bkg;
				break;
			case 4: // Gauche
				bkg = 4;
				lastbkg = bkg;
				break;
			default:
				bkg = lastbkg;
				break;
			}
			
			// Défilement des ennemis

			// Défilement des projectiles



		//========================================================================================================================
		// Boucle fenêtre > Boucle visuelle
		//timeDraw = clockDraw.getElapsedTime(); //Prends le temps de l’horloge
		//if (timeDraw.asMilliseconds() >= 1000/FRAMERATE) //En milisecondes (100.0f)
		//{
			// Effacement de la fenêtre en noir
			window.clear();

			// On dessine le background
			background[bkg].draw(window); // On dessine le background



			window.draw(sPlayer);
			// Fin de la frame courante, affichage de tout ce qu'on a dessiné
			window.display();

	//		clockDraw.restart(); // On remet l’horloge à 0
	//	}
	}
	
	//========================================================================================================================
	// Fin
	std::cout << endl;
	system("pause");
	return 0;

}
